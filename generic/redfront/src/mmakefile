# ----------------------------------------------------------------------
# $Id$
# ----------------------------------------------------------------------
# Copyright (c) 2006-2009 Andreas Dolzmann and Thomas Sturm
# ----------------------------------------------------------------------
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#
#    * Redistributions of source code must retain the relevant
#      copyright notice, this list of conditions and the following
#      disclaimer.
#    * Redistributions in binary form must reproduce the above
#      copyright notice, this list of conditions and the following
#      disclaimer in the documentation and/or other materials provided
#      with the distribution.
# 
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
# "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
# A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
# OWNERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
# SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

REMACC=${USER}@dormouse.fmi.uni-passau.de
REMDIR=$(REMACC):/home/reduce/public_html/develop/reduce/packages/redfront

configure: configure.in
	autoconf

config.h.in: configure.in
	autoheader

configure-linux-csl:
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-Wl,-rpath,." ./configure \
		--with-csl=/usr/local/reduce/lisp/csl/linux/csl \
		--with-img=/usr/local/reduce/lisp/csl/linux/reduce.img

install-linux-csl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront csl/linux

linux-csl:
	make -f mmakefile configure-linux-csl
	make -f Makefile
	make -f mmakefile install-linux-csl

upload-linux-csl:
	scp csl/linux/redfront $(REMDIR)/csl/linux; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

configure-linux-psl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-Wl,-rpath,." ./configure \
		--with-bpsl=/usr/local/reduce/lisp/psl/linux/psl/bpsl \
		--with-img=/usr/local/reduce/lisp/psl/linux/red/reduce.img

install-linux-psl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront psl/linux

linux-psl:
	make -f mmakefile configure-linux-psl
	make -f Makefile
	make -f mmakefile install-linux-psl

upload-linux-psl:
	scp psl/linux/redfront $(REMDIR)/psl/linux; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

linux: linux-csl linux-psl

upload-linux: upload-linux-csl upload-linux-psl

configure-macg4-csl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macg4 \
		--with-csl=/Applications/reduce/lisp/csl/macg4/csl \
		--with-img=/Applications/reduce/lisp/csl/macg4/reduce.img

configure-macg4-csl-deb: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macg4 \
		--with-csl=/Applications/reduce/lisp/csl/macg4/csl \
		--with-img=/Applications/reduce/lisp/csl/macg4/reduce.img \
		--enable-debug

install-macg4-csl:
	make -f Makefile clean
	chmod 775 redfront
	mv redfront csl/macg4

macg4-csl:
	make -f mmakefile configure-macg4-csl
	make -f Makefile
	make -f mmakefile install-macg4-csl

upload-macg4-csl:
	scp csl/macg4/redfront $(REMDIR)/csl/macg4; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

configure-macg4-psl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macg4 \
		--with-bpsl=/Applications/reduce/lisp/psl/macg4/psl/bpsl \
		--with-td=16000000 \
		--with-img=/Applications/reduce/lisp/psl/macg4/red/reduce.img

configure-macg4-psl-deb: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macg4 \
		--with-bpsl=/Applications/reduce/lisp/psl/macg4/psl/bpsl \
		--with-td=16000000 \
		--with-img=/Applications/reduce/lisp/psl/macg4/red/reduce.img \
		--enable-debug

install-macg4-psl:
	make -f Makefile clean
	chmod 775 redfront
	mv redfront psl/macg4

macg4-psl:
	make -f mmakefile configure-macg4-psl
	make -f Makefile
	make -f mmakefile install-macg4-psl

upload-macg4-psl:
	scp psl/macg4/redfront $(REMDIR)/psl/macg4; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

macg4: macg4-csl macg4-psl

upload-macg4: upload-macg4-psl upload-macg4-csl

configure-macintel-csl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macintel \
		--with-csl=/Applications/reduce/lisp/csl/macintel/csl \
		--with-img=/Applications/reduce/lisp/csl/macintel/reduce.img

configure-macintel-csl-deb: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce --with-machine=macintel \
		--with-csl=/Applications/reduce/lisp/csl/macintel/csl \
		--with-img=/Applications/reduce/lisp/csl/macintel/reduce.img \
		--enable-debug

install-macintel-csl:
	make -f Makefile clean
	chmod 775 redfront
	mv redfront csl/macintel

macintel-csl:
	make -f mmakefile configure-macintel-csl
	make -f Makefile
	make -f mmakefile install-macintel-csl

upload-macintel-csl:
	scp csl/macintel/redfront $(REMDIR)/csl/macintel; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

configure-macintel-psl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-root=/Applications/reduce \
		--with-machine=macintel \
		--with-bpsl=/Applications/reduce/lisp/psl/macintel/psl/bpsl \
		--with-td=128000000 \
		--with-img=/Applications/reduce/lisp/psl/macintel/red/reduce.img

install-macintel-psl:
	make -f Makefile clean
	chmod 775 redfront
	mv redfront psl/macintel

macintel-psl:
	make -f mmakefile configure-macintel-psl
	make -f Makefile
	make -f mmakefile install-macintel-psl

upload-macintel-psl:
	scp psl/macintel/redfront $(REMDIR)/psl/macintel; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

macintel: macintel-csl macintel-psl

upload-macintel: upload-macintel-psl upload-macintel-csl

configure-solaris-csl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	unset LD_LIBRARY_PATH; ./configure --with-machine=solaris \
		--with-csl=/usr/local/reduce/lisp/csl/solaris/csl \
		--with-img=/usr/local/reduce/lisp/csl/solaris/reduce.img

install-solaris-csl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront csl/solaris

solaris-csl:
	make -f mmakefile configure-solaris-csl
	make -f Makefile
	make -f mmakefile install-solaris-csl

upload-solaris-csl:
	scp csl/solaris/redfront $(REMDIR)/csl/solaris; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

configure-solaris-psl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	unset LD_LIBRARY_PATH; ./configure --with-machine=solaris \
		--with-bpsl=/usr/local/reduce/lisp/psl/solaris/psl/bpsl \
		--with-img=/usr/local/reduce/lisp/psl/solaris/red/reduce.img

install-solaris-psl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront psl/solaris

solaris-psl:
	make -f mmakefile configure-solaris-psl
	make -f Makefile
	make -f mmakefile install-solaris-psl

upload-solaris-psl:
	scp psl/solaris/redfront $(REMDIR)/psl/solaris; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

solaris: solaris-csl solaris-psl

upload-solaris: upload-solaris-csl upload-solaris-psl

configure-amd64-csl:
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-Wl,-rpath,." ./configure \
		--with-machine=amd64 \
		--with-csl=/usr/local/reduce/lisp/csl/amd64/csl \
		--with-img=/usr/local/reduce/lisp/csl/amd64/reduce.img

install-amd64-csl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront csl/amd64

amd64-csl:
	make -f mmakefile configure-amd64-csl
	make -f Makefile
	make -f mmakefile install-amd64-csl

upload-amd64-csl:
	scp csl/amd64/redfront $(REMDIR)/csl/amd64; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

configure-amd64-psl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-Wl,-rpath,." ./configure \
		--with-machine=amd64 \
		--with-bpsl=/usr/local/reduce/lisp/psl/amd64/psl/bpsl \
		--with-img=/usr/local/reduce/lisp/psl/amd64/red/reduce.img

install-amd64-psl:
	make -f Makefile clean
	strip redfront
	chmod 775 redfront
	mv redfront psl/amd64

amd64-psl:
	make -f mmakefile configure-amd64-psl
	make -f Makefile
	make -f mmakefile install-amd64-psl

upload-amd64-psl:
	scp psl/amd64/redfront $(REMDIR)/psl/amd64; \
	ssh $(REMACC) \
           "cd /home/reduce/public_html/develop/reduce/packages/redfront; \
            xport -sign"

amd64: amd64-csl amd64-psl

upload-amd64: upload-amd64-csl upload-amd64-psl

configure-sf-csl: configure config.h.in
	make -f mmakefile configure
	make -f mmakefile config.h.in
	rm -rf config.status config.log autom4te.cache
	LDFLAGS="-L/sw/lib" CFLAGS="-I/sw/include" ./configure \
		--with-reduce-binary=$$(pwd)/../../bin/reduce \
		--with-redfront-root=$$(pwd)
